<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BÃ­ áº¨n Äáº§u TiÃªn Cá»§a Lá»… Halloween</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: url('https://i.pinimg.com/1200x/59/e5/4a/59e54a0eff9a67102aa45f6909569d39.jpg') center/cover no-repeat;
  font-family: 'Courier New', monospace;
  color: #fff;
  overflow: hidden;
  position: relative;
  transition: background 1.5s ease;
}
body.fade-to-black {
  background: black;
}
.overlay {
  position: absolute;
  inset: 0;
  z-index: 1;
}
.chat-box {
  position: absolute;
  bottom: 2%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 1000px;
  height: 35%;
  background: rgba(15, 15, 15, 0.8);
  border: 1.5px solid #ff884d;
  border-radius: 14px 14px 0 0;
  padding: 1.5%;
  overflow-y: auto;
  box-shadow: 0 -2px 25px rgba(255, 136, 77, 0.5);
  z-index: 3;
  backdrop-filter: blur(4px);
}
.message {
  margin: 10px 0;
  opacity: 0;
  transform: translateY(10px);
  animation: fadeIn 0.6s forwards;
}
.npc {
  text-align: left;
  color: #ff9100;
  text-shadow: 0 0 8px #ff6f00, 0 0 20px #ff9100;
  font-style: italic;
  letter-spacing: 0.5px;
}
.player {
  text-align: right;
  color: #00ffff;
  text-shadow: 0 0 6px #00bcd4, 0 0 12px #00ffff;
  font-weight: 500;
}
.speaker {
  font-weight: bold;
  margin-bottom: 2px;
  font-size: 0.85rem;
  opacity: 0.8;
}
.choices {
  margin-top: 18px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.choice {
  background: rgba(40, 40, 40, 0.9);
  color: #fff;
  border: 1px solid #ff884d;
  border-radius: 6px;
  padding: 10px;
  cursor: pointer;
  transition: all 0.25s ease;
  text-align: center;
}
.choice:hover {
  background: #ff884d;
  color: #000;
  transform: scale(1.02);
}
@keyframes fadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.chat-box::-webkit-scrollbar {
  width: 6px;
}
.chat-box::-webkit-scrollbar-thumb {
  background-color: rgba(255, 136, 77, 0.6);
  border-radius: 4px;
}
.chat-box::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
}
.fade-overlay {
  position: fixed;
  inset: 0;
  background: transparent;
  transition: background 1.5s ease;
  z-index: 99;
}
.fadein-chat {
  opacity: 0;
  animation: appear 1s 1.5s forwards;
  z-index: 100;
}
@keyframes appear {
  to { opacity: 1; }
}
.flame {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 50px;
  height: 80px;
  background: radial-gradient(circle at 50% 20%, orange 0%, red 70%, transparent 80%);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  animation: flicker 0.3s infinite alternate;
  filter: blur(1px);
}
@keyframes flicker {
  from { transform: translate(-50%, -50%) scale(1); opacity: 0.9; }
  to { transform: translate(-50%, -52%) scale(1.05); opacity: 1; }
}
.next-screen {
  color: #ff9100;
  font-size: 1.5rem;
  text-align: center;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.typing-indicator {
  font-style: italic;
  opacity: 0.6;
  font-size: 0.85rem;
  animation: blink 1s infinite;
}
@keyframes blink {
  50% { opacity: 0.3; }
}
</style>
</head>
<body>
<div class="overlay"></div>
<div class="chat-box" id="chatBox"></div>

<script>
const story = {
  start: {
    speaker: "Lyra",
    text: "Xin chÃ oâ€¦, cáº­u bá»‹ láº¡c vÃ o Ä‘Ã¢y Ã ?",
    choices: [
      { text: "á»ª, tá»› tháº¥y á»Ÿ Ä‘Ã¢y cÃ³ cÄƒn nhÃ â€¦ mÃ  cáº­u lÃ  ai?", next: "branch1" },
      { text: "TÃ´i chá»‰ Ä‘ang tÃ¬m chá»— trÃº qua Ä‘Ãªm thÃ´i, á»Ÿ Ä‘Ã¢y quá»· dá»‹ quÃ¡", next: "branch2" }
    ]
  },
  branch1: {
    text: "Tá»› lÃ  Lyra. NgÃ y xÆ°a tÃ´i tá»«ng giá»¯ Ä‘Ã¨n cho thá»‹ tráº¥n nÃ y, trÆ°á»›c khi ngá»n lá»­a Ä‘Ã³ táº¯t Ä‘i.",
    choices: [
      { text: "Nghe nhÆ° truyá»n thuyáº¿t áº¥y nhá»‰, cáº­u Ä‘á»‹nh dá»a tá»› Ã ?", next: "branch3" },
      { text: "Ngá»n lá»­a nÃ o cÆ¡, mÃ  sao nÃ³ láº¡i táº¯t Ä‘i?", next: "branch4" }
    ]
  },
  branch2: {
    text: "Cáº­u khÃ´ng nÃªn á»Ÿ Ä‘Ã¢y lÃ¢u Ä‘Ã¢u. ÄÃªm nay Ä‘Ã¨n trong cÄƒn nhÃ  nÃ y tá»± sÃ¡ng Ä‘áº¥y.",
    choices: [
      { text: "ÄÃ¨n tá»± sÃ¡ng? Cáº­u Ä‘ang Ä‘Ã¹a tá»› Ã ?", next: "branch3" },
      { text: "Ã cáº­u Ä‘Ãªm nay lÃ  Ä‘Ãªm Halloween vÃ  cáº­u Ä‘á»‹nh dá»a tá»› Ã ?", next: "branch4" }
    ]
  },
  branch3: {
    text: "Tá»› khÃ´ng Ä‘Ã¹a Ä‘Ã¢u. Nay lÃ  Ä‘Ãªm Halloween vÃ  má»i ngá»n Ä‘Ã¨n Ä‘á»u sáº½ Ä‘Æ°á»£c tháº¯p sÃ¡ng trá»Ÿ láº¡i, chá»‰ lÃ  Ä‘á»ƒ tÆ°á»Ÿng nhá»› vá» ngÆ°á»i canh giá»¯ nÃ³.",
    choices: [
      { text: "VÃ  cáº­u cÅ©ng lÃ  má»™t trong sá»‘ Ä‘Ã³, pháº£i khÃ´ng?", next: "branch5" }
    ]
  },
  branch4: {
    text: "Cáº­u tá»«ng nghe vá» Jack O'Lantern chÆ°a?",
    choices: [
      { text: "Jack O'Lantern, lÃ  chiáº¿c Ä‘Ã¨n bÃ­ ngÃ´ trong Halloween Ä‘áº¥y sao?", next: "branch5" },
      { text: "Tá»› tá»«ng nghe qua, Ä‘Ã³ lÃ  1 truyá»n thuyáº¿t xá»© Ireland,...", next: "branch6" }
    ]
  },
  branch5: {
    text: "ChÃ­nh lÃ  nhÆ° váº­y. Tá»› khÃ´ng lÃ m háº¡i cáº­u Ä‘Ã¢u. Tá»› chá»‰ Ä‘ang trÃ´ng giá»¯ má»™t ngá»n Ä‘Ã¨n chÆ°a tÃ¬m Ä‘Æ°á»£c chá»§ má»›i... vÃ  tá»› cÅ©ng lÃ  1 háº­u duá»‡ cá»§a Jack.",
    choices: [
      { text: "Nghe cáº£m Ä‘á»™ng tháº­t. Váº­y cáº­u muá»‘n gÃ¬ á»Ÿ tá»›?", next: "branch6" }
    ]
  },
  branch6: {
    text: "Uhmm, tá»› cÃ´ Ä‘Æ¡n láº¯m. Ngá»n lá»­a mÃ  khÃ´ng cÃ³ ai nhÃ¬n tháº¥y, thÃ¬ cÅ©ng cháº³ng khÃ¡c gÃ¬ lÃ  tro tÃ n.",
    choices: [
      { text: "Váº­y lÃ  cáº­u muá»‘n tá»› thay tháº¿ cáº­u Ã ?", next: "branch7" },
      { text: "Tháº¿ giá» ngá»n lá»­a áº¥y á»Ÿ Ä‘Ã¢u?", next: "branch8" }
    ]
  },
  branch7: {
    text: "Tá»› khÃ´ng Ã©p cáº­u Ä‘Ã¢u, nhÆ°ng náº¿u cáº­u Ä‘á»§ dÅ©ng cáº£m, tá»› sáº½ trao nÃ³ cho cáº­u. Äá»«ng sá»£ khi tháº¥y má»i thá»© má» Ä‘i.",
    choices: [
      { text: "Æ  tá»› chÆ°a sáºµn sÃ ng.", next: "end3" }
    ]
  },
  branch8: {
    text: "Ngay táº¡i Ä‘Ã¢y nÃ y, tá»› nghÄ© nÃ³ Ä‘Ã£ chá» ai Ä‘Ã³ tá»« ráº¥t lÃ¢u rá»“i.",
    choices: [
      { text: "TÃ´i sáº½ thá»­ tháº¯p nÃ³ lÃªn.", next: "end1" },
      { text: "TÃ´i nghÄ© tá»‘t hÆ¡n nÃªn Ä‘á»ƒ yÃªn nÃ³.", next: "end2" }
    ]
  },
  end1: {
    text: "Ãnh Ä‘Ã¨n vá»¥t sÃ¡ng, chiáº¿u qua sÆ°Æ¡ng. Giá»ng Lyra kháº½ vang: â€œCáº£m Æ¡n cáº­uâ€¦ Ngá»n lá»­a nhá»› Ä‘Æ°á»£c nhÃ¬n tháº¥y rá»“i.â€ ğŸŒ™",
    choices: []
  },
  end2: {
    text: "CÃ¡i bÃ³ng cá»§a Lyra bá»—ng biáº¿n máº¥t, Ä‘á»“ng thá»i lÃ  tiáº¿ng rÃ­t cá»§a giÃ³. Cá»© nhÆ° lÃ  cÃ´ nÃ ng bÃ­ áº©n Ä‘ang khÃ³c váº­y.",
    choices: []
  },
  end3: {
    text: "Má»i thá»© má» dáº§n, tÃ´i bá»—ng ngáº¥t Ä‘i, ...",
    choices: []
  }
};

const chatBox = document.getElementById("chatBox");
let skipTyping = false;

async function typeText(element, text, speed = 30) {
  element.textContent = "";
  for (let i = 0; i < text.length; i++) {
    if (skipTyping) {
      element.textContent = text;
      return;
    }
    element.textContent += text[i];
    await new Promise(r => setTimeout(r, speed));
  }
}

async function renderScene(sceneKey) {
  const scene = story[sceneKey];
  chatBox.innerHTML = "";

  // Hiá»‡n typing indicator
  const typingDiv = document.createElement("div");
  typingDiv.className = "message npc typing-indicator";
  typingDiv.textContent = `${scene.speaker || "..." } Ä‘ang nháº­p...`;
  chatBox.appendChild(typingDiv);
  chatBox.scrollTop = chatBox.scrollHeight;

  await new Promise(r => setTimeout(r, 1200));
  typingDiv.remove();

  // Hiá»‡n thoáº¡i NPC
  const npcMsg = document.createElement("div");
  npcMsg.className = "message npc";
  npcMsg.innerHTML = `<div class="speaker">${scene.speaker || ""}</div><span class="typed"></span>`;
  chatBox.appendChild(npcMsg);
  const typedSpan = npcMsg.querySelector(".typed");

  skipTyping = false;
  document.addEventListener("click", () => skipTyping = true, { once: true });
  await typeText(typedSpan, scene.text);
  chatBox.scrollTop = chatBox.scrollHeight;

  // Hiá»‡n lá»±a chá»n
  if (scene.choices && scene.choices.length > 0) {
    const choiceContainer = document.createElement("div");
    choiceContainer.className = "choices";

    scene.choices.forEach(choice => {
      const btn = document.createElement("div");
      btn.className = "choice";
      btn.textContent = choice.text;
      btn.onclick = () => {
        const playerMsg = document.createElement("div");
        playerMsg.className = "message player";
        playerMsg.textContent = choice.text;
        chatBox.appendChild(playerMsg);
        chatBox.scrollTop = chatBox.scrollHeight;
        document.querySelectorAll(".choice").forEach(c => c.style.pointerEvents = "none");
        setTimeout(() => renderScene(choice.next), 1000);
      };
      choiceContainer.appendChild(btn);
    });

    chatBox.appendChild(choiceContainer);
  }

  if (sceneKey.startsWith("end")) {
    setTimeout(() => playEnding(sceneKey), 3500);
  }
}

function playEnding(endKey) {
  const overlay = document.createElement("div");
  overlay.className = "fade-overlay";
  document.body.appendChild(overlay);

  setTimeout(() => {
    document.body.classList.add("fade-to-black");
    chatBox.style.display = "none";
  }, 1000);

  setTimeout(() => {
    overlay.innerHTML = "";
    const newChat = document.createElement("div");
    newChat.className = "chat-box fadein-chat";
    document.body.appendChild(newChat);

    let messageText = "";
    if (endKey === "end1") {
      const flame = document.createElement("div");
      flame.className = "flame";
      overlay.appendChild(flame);
      messageText = "Váº­y lÃ  cáº­u Ä‘Ã£ cháº¥p nháº­n lá»i Ä‘á» nghá»‹ cá»§a tá»›, cÅ©ng nhÆ° Ä‘Ã£ giáº£i Ä‘Ã¡p Ä‘Æ°á»£c bÃ­ áº©n cá»§a Jack O'Lantern. Giá» thÃ¬ hÃ£y Ä‘áº¿n vá»›i bÃ­ áº©n thá»© hai.";
    } else if (endKey === "end2") {
      messageText = "Váº­y Ã , cÅ©ng Ä‘Ã nh thÃ´i, tá»› cÅ©ng khÃ´ng Ã©p cáº­u ná»¯a. Giá» thÃ¬ hÃ£y Ä‘i tÃ¬m hiá»ƒu bÃ­ áº©n thá»© 2 Ä‘i.";
    } else if (endKey === "end3") {
      messageText = "Tá»› xin lá»—i, dÃ¹ gÃ¬ thÃ¬ ta cÅ©ng khÃ´ng gáº·p láº¡i nhau ná»¯a. Giá» thÃ¬ hÃ£y Ä‘i tÃ¬m hiá»ƒu bÃ­ áº©n thá»© 2 Ä‘i.";
    }

    const msg = document.createElement("div");
    msg.className = "message npc";
    msg.textContent = messageText;
    newChat.appendChild(msg);
  }, 2500);

  setTimeout(() => {
    document.body.innerHTML = "<div class='next-screen'>Cáº£m Æ¡n Htrang Ä‘Ã£ dÃ nh thá»i gian Ä‘á»ƒ tráº£i nghiá»‡m, vÃ¬ 1 chÃºt vÃ¡n Ä‘á» ká»¹ thuáº­t, pháº§n 2 sáº½ sá»›m Ä‘Æ°á»£c tui thÃªm vÃ o vÃ o 1 dá»‹p láº§n sau.</div>";
  }, 7500);
}

renderScene("start");
</script>
</body>
</html>
